import{j as a,B as j,e as l,y as v,P as g,a6 as I,a9 as B,a7 as T,W as S,aa as i,ab as d,x as o,ac as W,E as U,Z as F}from"./mui-vendor-DKc3DNyo.js";import{a as r}from"./react-vendor-CMMogCvm.js";import{a as L}from"./index-6j_amgYy.js";import{a as b}from"./api-CiziFmkg.js";import{u as M,i as u}from"./utils-2Mkw4TjN.js";const q=()=>{const{t}=M(),{darkMode:f,toggleTheme:y}=L(),[s,h]=r.useState({language:u.language,downloadPath:"",maxDownloadSpeed:0,maxUploadSpeed:0,maxConnections:200,port:6881,dht:!0,peerExchange:!0,localPeerDiscovery:!0}),[C,x]=r.useState(!1),[w,m]=r.useState(!0),[p,c]=r.useState(null);r.useEffect(()=>{P()},[]);const P=async()=>{try{m(!0);const e=await b.getSettings();h({language:e.language||u.language,downloadPath:e.downloadPath||"",maxDownloadSpeed:e.maxDownloadSpeed||0,maxUploadSpeed:e.maxUploadSpeed||0,maxConnections:e.maxConnections||200,port:e.port||6881,dht:e.dht!==!1,peerExchange:e.peerExchange!==!1,localPeerDiscovery:e.localPeerDiscovery!==!1})}catch(e){c("Failed to load settings"),console.error(e)}finally{m(!1)}},D=async()=>{try{c(null),await b.updateSettings(s),localStorage.setItem("language",s.language),u.changeLanguage(s.language),x(!0),setTimeout(()=>x(!1),3e3)}catch(e){c("Failed to save settings"),console.error(e)}},n=(e,E)=>{h(k=>({...k,[e]:E}))};return w?a.jsx(j,{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh",children:a.jsx(l,{children:"Loading..."})}):a.jsxs(j,{children:[a.jsx(l,{variant:"h5",gutterBottom:!0,children:t("navigation.settings")}),p&&a.jsx(v,{severity:"error",sx:{mb:3},children:p}),a.jsxs(g,{sx:{p:3,mb:3},children:[a.jsx(l,{variant:"h6",gutterBottom:!0,children:t("settings.general")}),a.jsxs(I,{fullWidth:!0,sx:{mb:2},children:[a.jsx(B,{children:t("settings.language")}),a.jsxs(T,{value:s.language,label:t("settings.language"),onChange:e=>n("language",e.target.value),children:[a.jsx(S,{value:"ja",children:"日本語"}),a.jsx(S,{value:"en",children:"English"})]})]}),a.jsx(i,{control:a.jsx(d,{checked:f,onChange:y}),label:t("settings.darkMode")})]}),a.jsxs(g,{sx:{p:3,mb:3},children:[a.jsx(l,{variant:"h6",gutterBottom:!0,children:t("settings.downloads")}),a.jsx(o,{fullWidth:!0,label:t("settings.downloadPath"),value:s.downloadPath,onChange:e=>n("downloadPath",e.target.value),sx:{mb:2}}),a.jsx(o,{fullWidth:!0,type:"number",label:t("settings.maxDownloadSpeed"),value:s.maxDownloadSpeed,onChange:e=>n("maxDownloadSpeed",parseInt(e.target.value)),helperText:"0 = unlimited (KB/s)",sx:{mb:2}}),a.jsx(o,{fullWidth:!0,type:"number",label:t("settings.maxUploadSpeed"),value:s.maxUploadSpeed,onChange:e=>n("maxUploadSpeed",parseInt(e.target.value)),helperText:"0 = unlimited (KB/s)"})]}),a.jsxs(g,{sx:{p:3,mb:3},children:[a.jsx(l,{variant:"h6",gutterBottom:!0,children:t("settings.network")}),a.jsx(o,{fullWidth:!0,type:"number",label:t("settings.port"),value:s.port,onChange:e=>n("port",parseInt(e.target.value)),sx:{mb:2}}),a.jsx(o,{fullWidth:!0,type:"number",label:t("settings.maxConnections"),value:s.maxConnections,onChange:e=>n("maxConnections",parseInt(e.target.value)),sx:{mb:2}}),a.jsx(W,{sx:{my:2}}),a.jsx(i,{control:a.jsx(d,{checked:s.dht,onChange:e=>n("dht",e.target.checked)}),label:t("settings.dht")}),a.jsx(i,{control:a.jsx(d,{checked:s.peerExchange,onChange:e=>n("peerExchange",e.target.checked)}),label:t("settings.peerExchange")}),a.jsx(i,{control:a.jsx(d,{checked:s.localPeerDiscovery,onChange:e=>n("localPeerDiscovery",e.target.checked)}),label:t("settings.localPeerDiscovery")})]}),C&&a.jsx(v,{severity:"success",sx:{mb:3},children:t("messages.settingsSaved")}),a.jsx(U,{variant:"contained",startIcon:a.jsx(F,{}),onClick:D,size:"large",children:t("common.save")})]})};export{q as default};
