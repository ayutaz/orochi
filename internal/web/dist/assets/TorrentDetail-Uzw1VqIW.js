import{j as e,B as l,e as r,E as y,Z as _,_ as A,$ as z,a0 as P,a1 as f,a2 as a,a3 as R,a4 as B,a5 as G,F as J,a6 as O,a7 as Q,W as D,t as $,O as L,m as X,I as E,a8 as H,y as Z,Q as K,R as V,X as Y,P as N,J as u,b as ee,s as se,q as re,r as F}from"./mui-vendor-DKc3DNyo.js";import{c as te,a as j,k as ne,u as ae}from"./react-vendor-CMMogCvm.js";import{a as v}from"./api-CiziFmkg.js";import{f as g,a as C}from"./format-h-zLgRWV.js";import{u as M}from"./utils-2Mkw4TjN.js";import{u as le}from"./index-6j_amgYy.js";const ie=({torrent:i})=>{const{t:o}=M(),[n,h]=j.useState(i.info.files||[]),[m,p]=j.useState(!1),s=t=>{h(n.map(x=>({...x,selected:t}))),p(!0)},w=(t,x)=>{const d=[...n];d[t]={...d[t],selected:x},h(d),p(!0)},I=(t,x)=>{const d=[...n];d[t]={...d[t],priority:x},h(d),p(!0)},S=async()=>{try{await v.updateFiles(i.id,n.map(t=>({path:t.path.join("/"),selected:t.selected!==!1}))),p(!1)}catch(t){console.error("Failed to update files:",t)}},b=n.every(t=>t.selected!==!1),T=n.some(t=>t.selected!==!1)&&!b;return!n||n.length===0?e.jsxs(l,{sx:{textAlign:"center",py:4},children:[e.jsxs(r,{variant:"body1",color:"text.secondary",children:["Single file torrent: ",i.info.name]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:g(i.info.length)})]}):e.jsxs(l,{children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(l,{children:[e.jsx(y,{size:"small",onClick:()=>s(!0),sx:{mr:1},children:o("torrentDetail.selectAll")}),e.jsx(y,{size:"small",onClick:()=>s(!1),children:o("torrentDetail.deselectAll")})]}),m&&e.jsx(y,{variant:"contained",size:"small",startIcon:e.jsx(_,{}),onClick:S,children:"Save Changes"})]}),e.jsx(A,{children:e.jsxs(z,{size:"small",children:[e.jsx(P,{children:e.jsxs(f,{children:[e.jsx(a,{padding:"checkbox",children:e.jsx(R,{indeterminate:T,checked:b,onChange:t=>s(t.target.checked)})}),e.jsx(a,{children:"Name"}),e.jsx(a,{align:"right",children:"Size"}),e.jsx(a,{align:"center",children:"Priority"})]})}),e.jsx(B,{children:n.map((t,x)=>e.jsxs(f,{children:[e.jsx(a,{padding:"checkbox",children:e.jsx(R,{checked:t.selected!==!1,onChange:d=>w(x,d.target.checked)})}),e.jsx(a,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[t.path.length>1?e.jsx(G,{sx:{mr:1}}):e.jsx(J,{sx:{mr:1}}),e.jsx(r,{variant:"body2",noWrap:!0,children:t.path.join("/")})]})}),e.jsx(a,{align:"right",children:e.jsx(r,{variant:"body2",children:g(t.length)})}),e.jsx(a,{align:"center",children:e.jsx(O,{size:"small",variant:"standard",children:e.jsxs(Q,{value:t.priority||"normal",onChange:d=>I(x,d.target.value),disabled:t.selected===!1,children:[e.jsx(D,{value:"low",children:o("torrentDetail.priority.low")}),e.jsx(D,{value:"normal",children:o("torrentDetail.priority.normal")}),e.jsx(D,{value:"high",children:o("torrentDetail.priority.high")})]})})})]},x))})]})})]})},oe=te.memo(ie),W=[{id:"1",address:"192.168.1.100:51234",client:"qBittorrent/4.5.0",progress:45.2,downloadSpeed:125e3,uploadSpeed:45e3},{id:"2",address:"10.0.0.50:6881",client:"Transmission/3.00",progress:78.9,downloadSpeed:0,uploadSpeed:25e4}],ce=({})=>W.length===0?e.jsx(l,{sx:{textAlign:"center",py:4},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:"No connected peers"})}):e.jsx(A,{children:e.jsxs(z,{size:"small",children:[e.jsx(P,{children:e.jsxs(f,{children:[e.jsx(a,{children:"Address"}),e.jsx(a,{children:"Client"}),e.jsx(a,{align:"center",children:"Progress"}),e.jsx(a,{align:"right",children:"Download"}),e.jsx(a,{align:"right",children:"Upload"})]})}),e.jsx(B,{children:W.map(i=>e.jsxs(f,{children:[e.jsx(a,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace"},children:i.address})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:i.client})}),e.jsx(a,{align:"center",children:e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{sx:{width:"100%",mr:1},children:e.jsx($,{variant:"determinate",value:i.progress})}),e.jsx(l,{sx:{minWidth:35},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:`${Math.round(i.progress)}%`})})]})}),e.jsx(a,{align:"right",children:e.jsx(r,{variant:"body2",children:C(i.downloadSpeed)})}),e.jsx(a,{align:"right",children:e.jsx(r,{variant:"body2",children:C(i.uploadSpeed)})})]},i.id))})]})}),de=[{url:"udp://tracker.opentrackr.org:1337/announce",status:"working",peers:150,lastAnnounce:"2 minutes ago",nextAnnounce:"in 28 minutes"},{url:"udp://tracker.openbittorrent.com:6969/announce",status:"working",peers:89,lastAnnounce:"5 minutes ago",nextAnnounce:"in 25 minutes"},{url:"udp://tracker.example.com:8080/announce",status:"error",peers:0,error:"Connection timeout",lastAnnounce:"10 minutes ago",nextAnnounce:"in 5 minutes"}],xe=({})=>{const i=o=>{switch(o){case"working":return"success";case"error":return"error";case"disabled":return"default";default:return"default"}};return e.jsx(A,{children:e.jsxs(z,{size:"small",children:[e.jsx(P,{children:e.jsxs(f,{children:[e.jsx(a,{children:"Tracker"}),e.jsx(a,{align:"center",children:"Status"}),e.jsx(a,{align:"center",children:"Peers"}),e.jsx(a,{children:"Last Announce"}),e.jsx(a,{children:"Next Announce"})]})}),e.jsx(B,{children:de.map((o,n)=>e.jsxs(f,{children:[e.jsxs(a,{children:[e.jsx(r,{variant:"body2",sx:{wordBreak:"break-all"},children:o.url}),o.error&&e.jsx(r,{variant:"caption",color:"error",children:o.error})]}),e.jsx(a,{align:"center",children:e.jsx(L,{label:o.status,color:i(o.status),size:"small"})}),e.jsx(a,{align:"center",children:e.jsx(r,{variant:"body2",children:o.peers})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:o.lastAnnounce})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:o.nextAnnounce})})]},n))})]})})},ye=()=>{const{id:i}=ne(),o=ae(),{t:n}=M(),{lastMessage:h}=le(),[m,p]=j.useState(0),[s,w]=j.useState(null),[I,S]=j.useState(!0),[b,T]=j.useState(null);j.useEffect(()=>{t()},[i]),j.useEffect(()=>{if(h?.type==="torrents"&&h.data){const c=h.data.find(k=>k.id===i);c&&w(c)}},[h,i]);const t=async()=>{if(i)try{S(!0);const c=await v.getTorrent(i);w(c)}catch(c){T("Failed to load torrent details"),console.error(c)}finally{S(!1)}},x=async()=>{if(s)try{await v.startTorrent(s.id),await t()}catch(c){console.error("Failed to start torrent:",c)}},d=async()=>{if(s)try{await v.stopTorrent(s.id),await t()}catch(c){console.error("Failed to stop torrent:",c)}},q=async()=>{if(!(!s||!window.confirm(n("messages.confirmDelete"))))try{await v.deleteTorrent(s.id),o("/")}catch(c){console.error("Failed to delete torrent:",c)}},U=c=>{switch(c){case"downloading":return"primary";case"seeding":return"success";case"stopped":return"default";case"error":return"error";default:return"default"}};return I?e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh",children:e.jsx(X,{})}):b||!s?e.jsxs(l,{children:[e.jsxs(l,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(E,{onClick:()=>o("/"),sx:{mr:2},children:e.jsx(H,{})}),e.jsx(r,{variant:"h5",children:n("torrentDetail.title")})]}),e.jsx(Z,{severity:"error",children:b||"Torrent not found"})]}):e.jsxs(l,{children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[e.jsxs(l,{display:"flex",alignItems:"center",children:[e.jsx(E,{onClick:()=>o("/"),sx:{mr:2},children:e.jsx(H,{})}),e.jsx(r,{variant:"h5",children:s.info.name})]}),e.jsxs(l,{children:[s.status==="stopped"?e.jsx(y,{variant:"contained",startIcon:e.jsx(K,{}),onClick:x,sx:{mr:1},children:n("common.start")}):e.jsx(y,{variant:"outlined",startIcon:e.jsx(V,{}),onClick:d,sx:{mr:1},children:n("common.stop")}),e.jsx(y,{variant:"outlined",color:"error",startIcon:e.jsx(Y,{}),onClick:q,children:n("common.delete")})]})]}),e.jsx(N,{sx:{p:3,mb:3},children:e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:n("torrentDetail.status")}),e.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(L,{label:n(`status.${s.status}`),color:U(s.status),size:"small"}),s.error&&e.jsx(r,{variant:"body2",color:"error",children:s.error})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:n("torrentDetail.size")}),e.jsx(r,{variant:"body1",mb:2,children:g(s.info.length)})]}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:n("torrentDetail.progress")}),e.jsxs(l,{mb:2,children:[e.jsx($,{variant:"determinate",value:s.progress,sx:{height:8,borderRadius:4,mb:1}}),e.jsxs(l,{display:"flex",justifyContent:"space-between",children:[e.jsxs(r,{variant:"body2",children:[g(s.downloaded)," / ",g(s.info.length),"(",s.progress.toFixed(1),"%)"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[n("torrentDetail.uploaded"),": ",g(s.uploaded)]})]})]})]}),(s.status==="downloading"||s.status==="seeding")&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{item:!0,xs:6,md:3,children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(ee,{fontSize:"small"}),e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:n("torrentDetail.downloadSpeed")})]}),e.jsx(r,{variant:"h6",children:C(s.downloadRate||0)})]}),e.jsxs(u,{item:!0,xs:6,md:3,children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(se,{fontSize:"small"}),e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:n("torrentDetail.uploadSpeed")})]}),e.jsx(r,{variant:"h6",children:C(s.uploadRate||0)})]})]}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:n("torrentDetail.infoHash")}),e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace"},children:s.info.infoHash})]})]})}),e.jsxs(N,{sx:{p:3},children:[e.jsxs(re,{value:m,onChange:(c,k)=>p(k),sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(F,{label:n("torrentDetail.tabs.files")}),e.jsx(F,{label:n("torrentDetail.tabs.peers")}),e.jsx(F,{label:n("torrentDetail.tabs.trackers")})]}),e.jsxs(l,{sx:{mt:3},children:[m===0&&e.jsx(oe,{torrent:s}),m===1&&e.jsx(ce,{torrentId:s.id}),m===2&&e.jsx(xe,{torrentId:s.id})]})]})]})};export{ye as default};
